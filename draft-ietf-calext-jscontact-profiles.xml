<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE rfc [
<!ENTITY nbsp "&#160;">
<!ENTITY zwsp "&#8203;">
<!ENTITY nbhy "&#8209;">
<!ENTITY wj "&#8288;">
]>
<rfc xmlns:xi="http://www.w3.org/2001/XInclude" ipr="trust200902" docName="draft-ietf-calext-jscontact-profiles-10" submissionType="IETF" consensus="true" category="std" xml:lang="en" obsoletes="" updates="" tocInclude="true" symRefs="true" sortRefs="true" version="3">
  <front>
    <title abbrev="JSContact Profiles">Protocol-Specific Profiles for JSContact</title>
    <seriesInfo name="RFC" value="draft-ietf-calext-jscontact-profiles-10"/>
    <author initials="R." surname="Stepanek" fullname="Robert Stepanek">
      <organization>Fastmail</organization>
      <address>
        <postal>
          <extaddr>PO Box 234</extaddr>
          <street>Collins St. West</street>
          <city>Melbourne</city>
          <region>VIC</region>
          <code>8007</code>
          <country>Australia</country>
          <region/>
        </postal>
        <email>rsto@fastmailteam.com</email>
      </address>
    </author>
    <author initials="M." surname="Loffredo" fullname="Mario Loffredo">
      <organization>IIT-CNR</organization>
      <address>
        <postal>
          <street>Via Moruzzi, 1</street>
          <city>Pisa</city>
          <code>56124</code>
          <country>Italy</country>
          <region/>
        </postal>
        <email>mario.loffredo@iit.cnr.it</email>
      </address>
    </author>
    <date year="2025" month="December" day="10"/>
    <area>art</area>
    <workgroup>calext</workgroup>
    <keyword>JSContact</keyword>
    <abstract>
      <t>This document defines JSContact profiles, an IANA registry for named subsets of JSContact elements. It aims to facilitate using JSContact in context of contact data exchange protocols or other use cases, in which supporting all of JSContact semantics might be inappropriate.</t>
    </abstract>
  </front>
  <middle>
    <section anchor="notational-conventions" numbered="true" toc="default">
      <name>Notational Conventions</name>
      <t>The key words "<bcp14>MUST</bcp14>", "<bcp14>MUST NOT</bcp14>", "<bcp14>REQUIRED</bcp14>", "<bcp14> SHALL</bcp14>", "<bcp14>SHALL NOT</bcp14>", "<bcp14>SHOULD</bcp14>", "<bcp14>SHOULD NOT</bcp14>", "<bcp14> RECOMMENDED</bcp14>", "<bcp14>NOT RECOMMENDED</bcp14>", "<bcp14>MAY</bcp14>", and "<bcp14>OPTIONAL</bcp14>" in this document are to be interpreted as described in BCP 14 <xref target="RFC2119" format="default" sectionFormat="of" derivedContent="RFC2119"/> <xref target="RFC8174" format="default" sectionFormat="of" derivedContent="RFC8174"/> when, and only when, they appear in all capitals, as shown here.</t>
      <t>The ABNF definitions in this document use the notations of <xref target="RFC5234"/>. ABNF rules not defined in this document are defined in <xref target="RFC5234"/> (such as the ABNF for DIGIT).</t>
    </section>
    <section anchor="introduction" numbered="true" toc="default">
      <name>Introduction</name>
      <t>The <xref target="RFC9553">JSContact</xref> contact card data model and format is designed for use in address book applications and directory services. Intended as an alternative to the prevalent <xref target="RFC6350">vCard</xref> data format, it covers vCard core semantics and extensions, and provides a rich model for personal names, postal addresses and localization. All JSContact elements are relevant for some contact card use case and, similar to vCard, implementations are expected to support these elements when exchanging contact card information using protocols such as <xref target="RFC6352">CardDAV</xref> and <xref target="RFC9610">JMAP for Contacts</xref>.</t>
      <t>In contrast, other protocols and internet standards might require exchanging <em>some</em> contact card information, but not all of what JSContact provides. <xref target="RFC9553" section="1.7.4"/> outlines how JSContact implementations may ignore unknown JSContact elements, but this only applies to future extensions of <xref target="RFC9553"/>; they are still expected to implement all elements of the core specification. Also, the extensibility of JSContact and the requirement to preserve arbitrary contact elements might not be adequate for some protocols.</t>
      <t>To make use of JSContact under these circumstances, this document defines a new IANA registry for JSContact that allows for registering named subsets of JSContact elements. These subsets are referred to as "JSContact profiles" and are meant to bring the following benefits:</t>
      <ul>
        <li>Protocol designers might be encouraged to use JSContact, rather than coming up with their own contacts format. This facilitates cross-protocol data exchange and migration.</li>
        <li>Different protocols use the same IANA registry to express which JSContact elements they support. This facilitates understanding their commonalities and reusing existing profiles.</li>
        <li>A central registry provides implementors of JSContact libraries with a consistent format documenting which profile supports what elements, rather than having to look up that information from possibly distinctly organized internet drafts.</li>
      </ul>
      <t>This document is organized as follows: <xref target="jscontact-profiles"/> defines JSContact profiles, <xref target="example"/> illustrates JSContact profiles by example, <xref target="iana-considerations"/> summarizes the relevant information for IANA to establish the JSContact Profiles registry.</t>
    </section>
    <section anchor="jscontact-profiles">
      <name>JSContact Profiles</name>
      <t>A JSContact profile is a named set of JSContact properties, value types and values. These JSContact elements <bcp14>MAY</bcp14> be further restricted by the profile, but a profile can not loosen restrictions. For example, a profile can define an originally optional property to become mandatory, but it can not make a mandatory property become optional.</t>
      <t>The JSContact elements <bcp14>MUST</bcp14> be registered in the IANA JSContact registry. A JSContact extension <bcp14>MAY</bcp14> define both a new profile and new properties or other elements, as long as they are registered at the same time. A JSContact profile <bcp14>MUST</bcp14> be registered at IANA (see <xref target="iana-considerations"/>). <xref target="name"/> defines how to name a JSContact profile, <xref target="properties"/> defines how to define the properties supported by that profile.</t>
      <t>A JSContact object complies with a profile if all its properties are in the set of properties defined by that profile and the property values comply with the profile restrictions for that property. A JSContact object can comply with multiple profiles, even with profiles that weren't defined at the time when the JSContact data was created. Accordingly, this document does not specify any means for JSContact data to communicate which profiles it complies with, e.g. it does not define a "profile" property for the Card object.</t>
      <t>All properties and values of a JSContact object that complies with a profile <bcp14>MUST</bcp14> also be valid (<xref target="RFC9553" section="1.7"/>). Handling JSContact data that is valid but that does not comply with the expected profile is protocol-specific. This document deliberately does not define such non-compliant data as <em>invalid</em>. Profile designers decide on their own strategies for handling non-compliant data, one of which may be to reject it as invalid. JSContact data that complies with a profile may still not be valid in the context of that protocol; the protocol specification <bcp14>MAY</bcp14> define additional restrictions that a profile cannot express.</t>
      <section anchor="name">
        <name>Profile Name</name>
        <t>A JSContact profile has a unique name. The name <bcp14>MUST</bcp14> only contain ASCII lowercase alphabetic and numeric characters, optionally separated by hyphens. It <bcp14>MUST</bcp14> start with an alphabetic character and it <bcp14>MUST</bcp14> be of at least 1 character and at most 255 characters in size. Formally, it <bcp14>MUST</bcp14> be a valid "profile-name" defined in <xref target="profile-name-abnf"/>.</t>
        <figure anchor="profile-name-abnf">
          <name>ABNF Rule for JSContact Profile Name</name>
          <sourcecode name="" type="abnf"><![CDATA[
profile-name = LALPHA *( ["-"] LALPHA / DIGIT ) ; at most 255 octets in size

LALPHA       = %x61-7A ; a-z
]]></sourcecode>
        </figure>
      </section>
      <section anchor="properties">
        <name>Profile Properties</name>
	<t>A profile defines a list of property entries that together determine the set of properties supported by that profile, as described in <xref target="supported-properties"/>. The list <bcp14>MUST NOT</bcp14> be empty.</t>
	<t>Each property entry consists of the following elements:</t>
        <dl newline="false">
          <dt>Property Name:</dt>
	  <dd>This is the name of the JSContact property that this entry refers to. This <bcp14>MUST</bcp14> be a property name registered in the "JSContact Properties" registry. A property name <bcp14>MAY</bcp14> occur multiple times in the property entry list if the profile-specific restrictions for that property can not be expressed with a single entry, but such multiple entries <bcp14>MUST NOT</bcp14> result in conflicting restrictions for the same property. This field <bcp14>MUST NOT</bcp14> be empty.</dd>
          <dt>Property Context:</dt>
	  <dd>This is a comma-separated list of JSContact object types that support this property in this profile. Each of these types <bcp14>MUST</bcp14> also be listed in the property contexts for this property in the "JSContact Properties" registry, but a profile <bcp14>MAY</bcp14> only support the property in a subset of these contexts. This field <bcp14>MUST NOT</bcp14> be empty.</dd>

          <dt>Restricted Attributes:</dt>
	  <dd>This restricts the attributes of the property.  This specification only defines how to restrict the attributes such that a property becomes mandatory in the listed property contexts, despite the property originally being defined to be optional in the same contexts. The verbatim value "mandatory" (without quotes) indicates that it is mandatory in this profile, the absence of any value indicates that this profile does not restrict the property attributes of the original definition.</dd>
          <dt>Restricted Property Type:</dt>
	  <dd>
		  <t>This restricts the property value type in the listed property contexts, even though the property was originally defined with a less restrictive type definition. If set, the original value type <bcp14>MUST</bcp14> contain some type signature in form "A|B" and the restricted value type <bcp14>MUST</bcp14> resemble the original except that some of the original "A|B" forms now only allow a subset of the original choices. Restricted property types can not redefine the <xref target="RFC9553" section="1.3.3" sectionFormat="parens">"defaultType" attribute</xref>, the rules when to set the <xref target="RFC9553" section="1.3.4" sectionFormat="parens">"@type" property</xref> of the original type definition still apply.</t>
		  <t>For example, one might want to restrict the "date" property of the Anniversary object to only allow partial dates as values. To do so, the original value type "PartialDate|Timestamp" can be restricted to "PartialDate". Note that the original value type need not be exactly in form "A|B". For example, the type signature "Id[A|B|C]" could be restricted to any of "Id[A|B]", "Id[A|C]", "Id[B|C]", "Id[A]", "Id[B]", "Id[C]", and the type signature "(A|B)[]" to one of "A[]" or "B[]".</t>
		  </dd>
          <dt>Restricted Enum Values:</dt>
	  <dd>This restricts the enumerated values defined for this property to a subset of those values. The values <bcp14>MUST</bcp14> be listed in the "JSContact Enum Values" registry for this property and context. Allowed values are separated by comma; the absence of any value indicates that all enumerated values are allowed. A profile <bcp14>MAY</bcp14> exclude the default enumerated value of a property, in which case all instances of the object <bcp14>MUST</bcp14> have this property set to one of the allowed values.</dd>
          <dt>Restricted PatchObject:</dt>
          <dd>This restricts the PatchObject value of this property such that each JSON Pointer key in the PatchObject <bcp14>MUST</bcp14> consist of exactly one <xref target="RFC6901" section="3" sectionFormat="parens">JSON Pointer reference token</xref>. For example, with this restriction the "localizations" property of the Card object can only patch properties of the Card object by replacing their values entirely. The verbatim value "yes" (without quotes) indicates that this profile restricts PatchObject keys to a single token; the absence of any value indicates that it does not restrict them. This <bcp14>MUST NOT</bcp14> be set to "yes" if the property value type is not a PatchObject.</dd>
        </dl>
        <t>All profiles <bcp14>MUST</bcp14> support "@type" and "version", and therefore profiles MUST NOT include entries for these properties.</t>
      </section>
      <section anchor="supported-properties">
        <name>Supported Properties</name>
        <t>The supported properties of a JSContact profile are determined by the profile's property entries and the contents of the IANA "JSContact Properties" registry, which is here referred to as "IANA-registered properties" for short. The "version" property of the Card object and the "@type" property of any object type are always supported.</t>
        <t>A Card object complies with the profile if all its properties are part of the supported properties and all property values are valid according to the restrictions defined in the applicable property entries. A PatchObject <bcp14>MUST NOT</bcp14> patch properties that are not supported in that profile.</t>
        <t>The following describes the steps to determine the supported properties:</t>
        <ol>
          <li>Initialize the set with all properties of the Card object for which a property entry contains "Card" in the Property Context of the profile. If no such entry exists then initialize the set with all IANA-registered properties of the Card object.</li>
          <li>For every property in the set having either an object type as value type, or a list or map or union of object types, add all properties for which a property entry contains those object types in the Property Context of the profile. If no such property entry exists then add all IANA-registered properties for the object types.</li>
          <li>Repeat the previous step until all object types that are value types of properties in the set have been considered.</li>
        </ol>
        <t><xref target="example-supported-properties"/> describes how to determine the supported properties of the example profile in <xref target="example"/>.</t>
      </section>
    </section>
    <section anchor="example">
      <name>Example Profile</name>
      <t>This section provides an example for a JSContact profile and illustrates how a JSContact Card complies with that profile. <xref target="example-supported-properties"/> describes how to determine the supported properties for that profile. The example profile is defined the same as if it would be registered in the IANA JSContact Profiles registry. See <xref target="iana-considerations"/> for the exact meaning of each registry item. This profile is just for illustration, it is not registered at IANA.</t>
      <t>The following assignments would be registered at IANA if this were a real profile:</t>
      <dl newline="true">
        <dt>Name:</dt>
        <dd>jscontact-simple</dd>
        <dt>Reference:</dt>
        <dd>This document, <xref target="example-profile-properties"/></dd>
      </dl>
      <t>The following table defines the properties of that profile:</t>
          <table anchor="example-profile-properties">
            <name>Properties of the "jscontact-simple" profile</name>
            <thead>
              <tr>
                <th>Property Name</th>
                <th>Property Context</th>
                <th>Restricted Attributes</th>
                <th>Restricted Property Type</th>
                <th>Restricted Enum Values</th>
                <th>Restricted PatchObject</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>addresses</td>
                <td>Card</td>
                <td/>
                <td/>
                <td/>
                <td/>
              </tr>
              <tr>
                <td>emails</td>
                <td>Card</td>
                <td/>
                <td/>
                <td/>
                <td/>
              </tr>
              <tr>
                <td>kind</td>
                <td>Card</td>
                <td/>
                <td/>
                <td>individual,org</td>
                <td/>
              </tr>
              <tr>
                <td>localizations</td>
                <td>Card</td>
                <td/>
                <td/>
                <td/>
                <td>yes</td>
              </tr>
              <tr>
                <td>name</td>
                <td>Card</td>
                <td/>
                <td/>
                <td/>
                <td/>
              </tr>
              <tr>
                <td>full</td>
                <td>Address</td>
                <td>mandatory</td>
                <td/>
                <td/>
                <td/>
              </tr>
              <tr>
                <td>components</td>
                <td>Name</td>
                <td/>
                <td/>
                <td/>
                <td/>
              </tr>
              <tr>
                <td>full</td>
                <td>Name</td>
                <td/>
                <td/>
                <td/>
                <td/>
              </tr>
              <tr>
                <td>kind</td>
                <td>NameComponent</td>
                <td/>
                <td/>
                <td/>
                <td/>
              </tr>
              <tr>
                <td>value</td>
                <td>NameComponent</td>
                <td/>
                <td/>
                <td/>
                <td/>
              </tr>
            </tbody>
          </table>
      <t>This profile describes contact cards that can only contain:</t>
      <ul>
        <li>Contact cards for individuals and organizations, but no other kinds such as groups or devices.</li>
        <li>Full postal address lines, but no address components or any other property of the Address object type.</li>
        <li>Full names and name components, but no other properties of the Name object type.</li>
        <li>Email addresses, where all properties of the EmailAddress object are supported.</li>
        <li>Localizations, with the restriction that the PatchObject must only patch properties of the Card object.</li>
      </ul>
      <t>The following Card object complies with the example profile:</t>
      <sourcecode type=""><![CDATA[
{
  "@type": "Card",
  "version": "1.0",
  "name": {
     "components": [
      { "kind": "given", "value": "Hayao" },
      { "kind": "surname", "value": "Miyazaki" }
    ]
  },
  "addresses": {
    "a1": {
      "full": "71 Cherry Court, Somewhere, 123SO, UK"
    }
  },
  "emails": {
    "e1": {
      "address": "hayao@example.com"
    }
  },
  "localizations": {
    "jp": {
      "name": {
        "components": [
         { "kind": "surname", "value": "宮崎" },
         { "kind": "given", "value": "駿" }
        ]
      }
    }
  }
}
]]></sourcecode>
      <t>Note that:</t>
      <ul>
        <li>The Address, Card, Name, and NameComponent object values only contain properties for which a property entry exists in the profile.</li>
        <li>The EmailAddress object contains the "address" property. This is allowed because the profile contains a property entry for the "emails" property of the Card object, but it does not define entries for the EmailAddress object properties. Consequently, all properties of the EmailAddress object can be set.</li>
        <li>The "full" property of the Address object is set. It is the only property allowed to be set in that profile for Address, and the "full" property is mandatory for this profile.</li>
        <li>The "kind" property of the the NameComponent objects is set to "surname" and "given", respectively. Since the profile does not restrict the enumerated values of this property, all valid NameComponent "kind" property values are supported.</li>
        <li>The "kind" property of the Card object is not set. The profile restricts the enumerated values of this property to "individual" and "org". Since "individual" is the default value for this property, there is no need to set it.</li>
      </ul>
    </section>
    <section anchor="iana-considerations" numbered="true" toc="default">
      <name>IANA Considerations</name>
      <section anchor="iana-jscontact-profile-registry" numbered="true" toc="default">
        <name>Creation of the JSContact Profile Registry</name>
        <t>IANA will add the "JSContact Profile" registry to the "JSContact" registry group. The purpose of this new registry is to register profiles for JSContact data. The registry policy to add a new profile to this registry is "Specification Required", while the registry policy to update an existing profile is "Expert Review". The change controller is IETF.</t>
        <t>Designated experts assert that all proposed assignments are valid according to the definitions in this document, e.g. they check that the profile name is unique, that the entries in the profile entries are syntactically valid, that only known property names are referred to, and that type restrictions do not incorrectly alter the type of a property. On the other hand, designated experts do not decide the contents of the profile as long as the assignments are valid.</t>
	<t>An entry in this registry consists of the following assignments, all of which <bcp14>MUST</bcp14> be set:</t>
        <dl newline="true">
          <dt>Name:</dt>
          <dd>This is the name of the profile. This field is immutable after creation. The name <bcp14>MUST</bcp14> be unique among all registered profiles and <bcp14>MUST</bcp14> comply with the definitions in <xref target="name"/>.</dd>
          <dt>Reference:</dt>
	  <dd>This refers to the specifications of the protocol or use case for which this profile applies. The reference <bcp14>MUST</bcp14> must include the section number or name that defines or updates the property entries for this profile, as defined in <xref target="properties"/>.</dd>
        </dl>
      </section>
      <section>
        <name>Initial Contents of the JSContact Profile Registry</name>
        <t>This document does not define any initial contents for the newly created registries.</t>
      </section>
    </section>
    <section anchor="security-considerations" numbered="true" toc="default">
      <name>Security Considerations</name>
      <t>This document does not provide new security considerations. The security considerations of <xref target="RFC9553" section="4" sectionFormat="of"/> apply.</t>
    </section>
  </middle>
  <back>
    <references>
      <name>References</name>
      <references>
        <name>Normative References</name>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.5234.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.6901.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.8174.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.9553.xml"/>
      </references>
      <references>
        <name>Informative References</name>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.6350.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.6352.xml"/>
        <xi:include href="https://bib.ietf.org/public/rfc/bibxml/reference.RFC.9610.xml"/>
      </references>
    </references>
    <section anchor="example-supported-properties">
      <name>Supported Properties Example</name>
      <t>The following illustrates how to determine the supported properties of the <xref target="example" sectionFormat="parens">example profile</xref>, according to the steps defined in <xref target="supported-properties"/>:</t>
      <ol>
        <li>
          <t>We initialize the set of supported properties with all profile properties for which the property context includes the "Card" object. The set now includes the properties:</t>
          <ul>
            <li>Card.addresses</li>
            <li>Card.emails</li>
            <li>Card.kind</li>
            <li>Card.localizations</li>
            <li>Card.name</li>
          </ul>
        </li>
        <li>Next, we determine which of the properties in the current set have an object type as value type. These are the "Card.address", "Card.emails" and "Card.name" properties, so we need to inspect the object types "Address", "EmailAddress" and "Name".</li>
        <li>
          <t>For the "Address" object type, the profile has an entry for the "full" property which contains the "Address" object in the Property Context, so we add that and only that to the set of supported properties. It now contains:</t>
          <ul>
            <li>Address.full</li>
            <li>Card.addresses</li>
            <li>Card.emails</li>
            <li>Card.kind</li>
            <li>Card.localizations</li>
            <li>Card.name</li>
          </ul>
          <t>The value type of the "Address.full" property is not an object type, so we need not consider a new object type to inspect. The remaining object types to inspect are the "EmailAddress" and "Name" objects.</t>
        </li>
        <li>
          <t>For the "EmailAddress" object type, the profile does not contain any entry where the Property Context contains the "EmailAddress" object. Instead, we add properties of the "JSContact Properties" registry where the property context includes the "EmailAddress" object. The set of supported properties now contains:</t>
          <ul>
            <li>Address.full</li>
            <li>Card.addresses</li>
            <li>Card.emails</li>
            <li>Card.kind</li>
            <li>Card.localizations</li>
            <li>Card.name</li>
            <li>EmailAddress.address</li>
            <li>EmailAddress.contexts</li>
            <li>EmailAddress.label</li>
            <li>EmailAddress.pref</li>
          </ul>
          <t>None of the newly added properties have object value types. The remaining object type to inspect is the "Name" object.</t>
        </li>
        <li>
          <t>For the "Name" object type, the profile explicitly lists the "components" and "full" properties, so we add them to the set of supported properties. It now contains:</t>
          <ul>
            <li>Address.full</li>
            <li>Card.addresses</li>
            <li>Card.emails</li>
            <li>Card.kind</li>
            <li>Card.localizations</li>
            <li>Card.name</li>
            <li>EmailAddress.address</li>
            <li>EmailAddress.contexts</li>
            <li>EmailAddress.label</li>
            <li>EmailAddress.pref</li>
            <li>Name.full</li>
            <li>Name.components</li>
          </ul>
          <t>The newly added Name.components property has object value type "NameComponent", so we add that to the list of object types to inspect.</t>
        </li>
        <li>
          <t>For the "NameComponent" object type, the profile does not explicitly list any property. Instead, we add properties of the "JSContact Properties" registry where the property context includes the "NameComponent" object. The set of supported properties now contains:</t>
          <ul>
            <li>Address.full</li>
            <li>Card.addresses</li>
            <li>Card.emails</li>
            <li>Card.kind</li>
            <li>Card.localizations</li>
            <li>Card.name</li>
            <li>EmailAddress.address</li>
            <li>EmailAddress.contexts</li>
            <li>EmailAddress.label</li>
            <li>EmailAddress.pref</li>
            <li>NameComponent.kind</li>
            <li>NameComponent.phonetic</li>
            <li>NameComponent.value</li>
          </ul>
          <t>None of the newly added properties have object value types and there are no remaining object types to inspect. This determines the set of supported properties by that profile, in addition to the "Card.version" and "@type" property that are always supported.</t>
        </li>
      </ol>
    </section>
  </back>
</rfc>
